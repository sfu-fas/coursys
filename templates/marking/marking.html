{% extends "marking/base.html" %}
{% load course_display %}

{% block marking_header_extra %}
<script type="text/javascript">
function append_problem(n, content)
{       
    var comments = document.getElementsByTagName("textarea");    
	var oldconent = comments[n-1].value;	
	comments[n-1].value += (oldconent == '' ? '' : '; ') + content;
}
</script>
{% endblock%}

{% block title %}{{activity.name}} Marking {% endblock %}
{% block h1 %}{{activity.name}} Marking {% endblock %}

{% block marking_subbreadcrumbs %}<li>&gt; <a href="{{ activity.get_absolute_url }}">{{activity.name}}</a></li><li>&gt; Marking</li>{% endblock %}

{% block content %}
     
<div id = "form_container">
<div id = "marking_container">
<form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
     {% if group %}
        <h2> Mark for Group: {{group}} </h2> 
     {% else %}
       {% if student %}           
        	<h2> Mark for Student: {{student.name}} ({{student.userid}}) </h2>       
       {% endif %}
     {% endif %}
	 {% for entry in mark_components %}  	     
	     <fieldset>
	     <legend><a href="{% url marking.views.manage_activity_components course_slug=course.slug activity_slug=activity.slug %}" title="Edit components">{{entry.component.title}}</a></legend> 
		     <ul class = "component">
		        <li>{{entry.component.description}}</li>
		        <li class="component_mark"> 
		        	Mark {{entry.form.value}} Out of {{entry.component.max_mark}}
		        	{% if entry.form.value.errors %}		        	
		        	<div class="errortext"><img src="{{MEDIA_URL}}icons/error.png" alt="error"/>&nbsp;{{entry.form.value.errors.0}}</div>	        	
		        	{% endif %}
		        </li>
		        <li class = "common_problems">
			    {% with forloop.counter as pos %}
			    Common problems:    
			    <div>
			    {% for problem in entry.common_problems %}			    	
			        <input class="common_problem" type="button" value="{{problem.title|escape}}" title="{{problem.description|escape}}{%if problem.penalty%} (penalty: {{problem.penalty}} points){%endif%}" 
			        onclick="append_problem({{pos}}, '{{problem.description|escapejs}}{%if problem.penalty%}(penalty: {{problem.penalty}} points){%endif%}');"/>
			    {% endfor %}
			    <a href="{% url marking.views.manage_common_problems course_slug=course.slug activity_slug=activity.slug%}" title = "Manage common problems">Manage...</a>
			    </div>			    
			    {% endwith %}			    
			    </li>
		        <li class="component_comment">		    		      		 
		        	{{entry.form.comment.label_tag}} {{ entry.form.comment }}
		      		{% if entry.form.comment.errors %}		      		
		      		<div class="errortext"><img src="{{MEDIA_URL}}icons/error.png" alt="error"/>&nbsp;{{entry.form.comment.errors.0}}</div>	        			      		
		      		{% endif %}		      				      	  	
				</li>			
		 	</ul>   	 
	  </fieldset>
     {% empty %}
	   	<p class="empty">Marking is not <a href="{% url marking.views.manage_activity_components course_slug=course.slug activity_slug=activity.slug %}" title="Edit components">configured</a>.
	    </p>
	 {% endfor %}	 
	 <fieldset>
	 <legend>Additional Information</legend>
	 {% if group %}
	   {{additional_info_form|display_form}}
	 {% else %}
	   {{additional_info_form|display_form_marknext}}
	 {% endif %}
	 </fieldset>     
</form>
</div>
</div>

{% endblock %}
