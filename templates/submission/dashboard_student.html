{% extends "submission/base.html" %}

{% block title %}Submission for {{activity.name}}{% endblock %}
{% block h1 %}Submission for {{activity.name}}{% endblock %}

{% block subbreadcrumbs %}<li>&gt; <a href="{% url grades.views.course_info course_slug=course.slug %}">{{course.name}}</a></li><li>&gt; <a href="{% url grades.views.activity_info course_slug=course.slug, activity_slug=activity.slug %}">{{activity.name}}</a></li><li>&gt; Submission</li>{% endblock %}

{% block content%}

{% ifequal submitted_pair|length 0 %}
    {# there is no component #}
{% else %}
        <div class="table_container">
        <table class="info">
            <tr>
                <th scope="row">Due Date:</th>
                <td>{{activity.due_date|date:"Y-m-d H:i:s"}}</td>
            </tr>
            <tr>
                <th scope="row">Latest Submission:</th>
                <td>{% if submission %} {{submission.created_at|date:"Y-m-d H:i:s"}} {% else %} No Submission {% endif %}</td>
            </tr>
            {% if late %}
            <tr id="late_for">
                <th scope="row">Late for:</th>
                <td>{{late}}</td>
            </tr>
            {% endif %}
            <tr>
                <th scope="row">Current Time:</th>
                <td>{% now "Y-m-d H:i:s" %}</td>
            </tr>
            {% if group %}
            <tr>
                <th scope="row">Group:</th>
                <td>{{group.name}}</td>
            </tr>
            {% endif %}
        </table>
        </div>

        {% block navbutton %}
        <div id="my_submission_dashboard"><h1>My Submission</h1>
        <ul class="add_nav">
            <li><a href="{% url submission.views.add_submission course_slug=course.slug, activity_slug=activity.slug %}" class="button">New Submission</a></li>
            {% if submit_time %}
            <li><a href="{% url submission.views.show_components_submission_history course_slug=course.slug activity_slug=activity.slug %}" class="button">View History</a></li>
            <li><a href="{% url submission.views.download_file course_slug=course.slug activity_slug=activity.slug userid=userid %}" class="button" target="_blank">Download All</a></li>
            {% endif %}
        </ul>
        </div>
        {% endblock %}

        <div id="form_container">
        <div id="component_view_student_container">

        {# <!-- pair<component, its latest submission> --> #}
        {% for pair in submitted_components %}
        <h2>{{pair.0.title}}</h2>
        <h3>{{pair.0.get_type}} Component</h3>
        <ul class="component_description">
            <li class="view"><label>Description:</label>{{pair.0.description}}</li>
            {% if pair.0.max_size %}<li class="view"><label>Max File Size:</label>{{pair.0.max_size}} KB</li>{% endif %}
        </ul>

        {% ifequal pair.1 None %}
            <div class="warningindicator">
                <img src="{{MEDIA_URL}}icons/cancel.png" alt="warning" />
                You haven't made a submission for this component.
            </div>
        {% else %}
            <div class="successindicator">
                <img src="{{MEDIA_URL}}icons/tick.png" alt="check" />
                You have made submission to this component.
                <ul class="component_description">
                    <li><label>Latest Submission: </label>{{pair.1.get_time}}</li>
                    {% ifequal pair.1.submission.get_type 'Group'%}
                        <li><label>Creator:</label>{{pair.1.submission.get_derived_class.creator}}</li>
                    {% endifequal %}
                    {% if pair.1.get_size %}
                        <li><label>File Size:</label>{{pair.1.get_size_in_kb}} KB</li>
                    {% endif %}
                    {% ifequal pair.1.get_type 'URL' %}
                        <li><label>URL:</label><a href="{{pair.1.get_url}}">{{pair.1.get_url}}</a></li>
                    {% else%}
                    {% ifequal pair.1.get_type 'PlainText' %}
                        <li><label>Text:</label><pre>{{pair.1.text}}</pre></li>
                    {% endifequal %}
                    {% endifequal %}
                    <li><img src="{{MEDIA_URL}}icons/attach.png" alt="download" /><a href="{% url submission.views.download_file course_slug=course.slug activity_slug=activity.slug component_slug=pair.0.slug submission_id=pair.1.submission.id %}">Download</a></li>
                </ul>
            </div>

        {% endifequal %}


        {% endfor %}
        </div>
        </div>

{% endifequal %}

{% endblock %}
