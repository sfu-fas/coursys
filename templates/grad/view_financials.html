{% extends "base.html" %}
{% load markup %}
{% load mobile_tags %}
{% load form_display %}

{% block title %}{{page_title}}{% endblock %}
{% block h1 %}{{page_title}}{% endblock %}

{% block actions %}
{% endblock %}

{% block headextra %}
<style type="text/css">
/* from W3 Dot Leaders */
ul.leaders {
    max-width: 100%;
    overflow-x: hidden;
    list-style: none
    }
ul.leaders li:before {
    float: left;
    width: 0;
    white-space: nowrap;
    content:
 ". . . . . . . . . . . . . . . . . . . . "
 ". . . . . . . . . . . . . . . . . . . . "
 ". . . . . . . . . . . . . . . . . . . . "
 ". . . . . . . . . . . . . . . . . . . . "
 }
ul.leaders li.comment:before{
	content:"";
}
ul.leaders li.helptext{
	padding-left: 2em;
}
ul.leaders span:first-child {
    padding-right: 1em;
    background: white
}
ul.leaders span + span {
    float: right;
    padding-left: 1em;
    padding-right: 2em;
    background: white;
}

div.scholarship_content {
	padding-left: 2em; 
	padding-right: 2em;
	clear: both;
}

div.promise_content { 
	text-align: right;
	padding-right: 1em;
	float: right;
	clear:both;
}

div.hr{
	border: 1px solid black;
	width: 98%;
}

div.scholarship_divider{
	border-right: 2px solid black;
	width: 75%;
	float: left;
}

span.label {
 	font-weight: bold
}

</style>
<script>
	$(document).ready(function() {
		{% for semester in semesters %}{% for scholarship in semester.scholarship_details.scholarships %}
		$('#{{semester.semester.name}}-{{scholarship.scholarship.id}}-comment').hide();
		{% endfor %}{% endfor %}
		{% for semester in semesters %}
		$('#{{semester.semester.name}}-comments-btn').click(function(){
			{% for scholarship in semester.scholarship_details.scholarships %}
			if ($('#{{semester.semester.name}}-{{scholarship.scholarship.id}}-comment').is(':hidden')){
				$('#{{semester.semester.name}}-{{scholarship.scholarship.id}}-comment').show();
			}else {
				$('#{{semester.semester.name}}-{{scholarship.scholarship.id}}-comment').hide();
			}
			{% for other_funding in semester.scholarship_details.other_funding %}
			if ($('#{{semester.semester.name}}-{{other_funding.id}}-comment').is(':hidden')){
				$('#{{semester.semester.name}}-{{other_funding.id}}-comment').show();
			}else {
				$('#{{semester.semester.name}}-{{other_funding.id}}-comment').hide();
			}			
			{% endfor %}{% endfor %}			
		});

		{% endfor %}
	});
</script>
{% endblock %}

{% block subbreadcrumbs %}
<li>
	&gt; <a href="{% url grad.views.index %}">Grads</a>
</li>
<li>
	&gt; <a href="{% url grad.views.view_all grad_slug=grad.slug%}">{{crumb}}</a>
</li>

<li>
	&gt; Financial Summary
</li>

{% endblock %}



{% block content %}

<div id="content_container">
	<div class="scholarship_divider">
	{% for semester in semesters %}
		<h2> {{ semester.semester }} - Status: {{ semester.status }} {% if semester.ta_ra.type %} {{ semester.ta_ra.type }} {% else %}{%endif%}</h2>
			<div class="scholarship_content">
				{% if semester.scholarship_details.scholarships %}
					<span class="label"> Scholarships: </span> 
					<div style="float: right" id="{{semester.semester.name}}-comments-btn"> <a>[View Comments]</a></div>
					<ul class="leaders">
					{% for scholarship in semester.scholarship_details.scholarships %}
						<li>
						{% if scholarship.scholarship.scholarship_type.eligible %}
								<span>{{scholarship.scholarship.scholarship_type.name}}</span>
								<span> ${{ scholarship.semester_amount|floatformat:2 }} </span>
						{% else %}
								<span>{{scholarship.scholarship.scholarship_type.name}} (${{ scholarship.semester_amount|floatformat:2 }})</span>
								<span> Not Eligible </span>
						{% endif %}
						</li>
						{% if scholarship.scholarship.comments %}
							<li class="helptext comment" id="{{semester.semester.name}}-{{scholarship.scholarship.id}}-comment">
								{{ scholarship.scholarship.comments }}
							</li>
							{% else %}
							<li class="helptext comment" id="{{semester.semester.name}}-{{scholarship.scholarship.id}}-comment">
								No comments recorded.    
							</li>
						{% endif %}
					{% endfor %}
					</ul>
				{% endif %}
				{% if semester.scholarship_details.other_funding %}
					<span class="label"> Other Funding: </span>
					<ul class="leader">
						{% for other_funding in semester.scholarship_details.other_funding %}
							<li>
								{% if other_funding.eligible %}
								<span>{{ other_funding.description}}</span>
								<span> ${{ other_funding.amount|floatformat:2 }} </span>
								{% else %}
								<span>{{ other_funding.description}} (${{ other_funding.amount|floatformat:2 }})</span>
								<span> Not Eligible </span>
								{% endif %}
							</li>
							{% if other_funding.comment %}
								<li class="helptext comment" id="{{semester.semester.name}}-{{other_funding.id}}-comment">{{ other_funding.comment }}</li>
														{% else %}
							<li class="helptext comment" id="{{semester.semester.name}}-{{scholarship.scholarship.id}}-comment">
								No comments recorded.
							</li>
							{% endif %}
						{% endfor %}
					</ul>
				{% endif %}
				{% if semester.ta_ra.type %}
				{% for type in semester.ta_ra.type %}
				<span class="label"> {{ semester.ta_ra.type }} Details: </span>
					<ul class="leaders">
						{% for course in semester.ta_ra.courses %}
						<li>
							<span>{{ course.course }}</span>
							<span> ${{ course.amount|floatformat:2 }}</span>
						</li>
						{% endfor %}
					</ul>
				{% endfor %}
				{% endif %}
				{% if semester.scholarship_details.semester_total %}
				<div class="hr"></div>
				<span style="float: left;" class="label">Semester Sub-Total</span>
				<span style="float: right; padding-right: 2em;"> ${{ semester.scholarship_details.semester_total|floatformat:2 }} </span>
				{% endif %}
			</div>
			<br />
			<br />
			
		{% if not promises and forloop.last %}
	</div> <!-- end divider div -->
		{% endif %}	
	    {% for promise in promises %}
	    {% if promise.promise == semester.promise and semester.semester == promise.promise.start_semester %}
    </div> <!-- end divider div -->
	    <div class="promise_content">
			<span class="label"> Promised Amount: </span> ${{ promise.promise.amount|floatformat:2 }} <br />
			<span class="label"> Received Amount: </span> ${{ promise.received|floatformat:2 }} <br />
			<div class="hr"></div>
			{% if promise.owing == -1 %}
				<span class="label">
					Amount Owing: None
				</span>
				
			{% else %}
				<span style="color: red" class="label">
					Amount Owing: (${{ promise.owing|floatformat:2 }})
				</span> 
			{% endif %}
			
		</div>
			{# if there are still promises to loop through, create another divider #}
			{% if not forloop.last %}
	<div class="divider">
			{% endif %}
		{% endif %}
		{% endfor %}
			
	{% endfor %}
</div>

{% endblock %} 