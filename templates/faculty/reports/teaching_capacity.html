{% extends "base.html" %}
{% load event_display %}

{% block title %}Teaching Capacity by Unit{% if semester %}: {{ semester }}{% endif %}{% endblock %}
{% block h1 %}Teaching Capacity by Unit{% if semester %}: {{ semester }}{% endif %}{% endblock %}

{% block headextra %}
<script type="text/javascript">
$(document).ready(function() {
  $('.capacity-unit i.fa-toggle-down').click(function () {
    var icon = $(this);
    var inner = icon.parent().parent().find('.capacity-unit-inner');

    if (inner.hasClass('hidden')) {
      icon.removeClass('fa-toggle-down');
      icon.addClass('fa-toggle-right');
    }
    else {
      icon.removeClass('fa-toggle-right');
      icon.addClass('fa-toggle-down');
    }
    inner.toggleClass('hidden');
  });

  $('.capacity-unit table').dataTable({
      bPaginate: false,
      bInfo: false,
      aaSorting: [[0, 'asc']],
      bJQueryUI: true
  });
} );
</script>

<style>
.capacity-unit {
  border: 2px solid;
  padding: 5px 10px 5px 10px;
  margin-bottom: 10px;
}
.capacity-unit:hover .fa {
  color: #a6192e;
}
.capacity-unit .fa {
  margin-right: 5px;
}
.capacity-unit h3 {
  margin: 0px;
}
.capacity-unit h3 small {
  float: right;
}
.capacity-unit .hidden {
  display: none;
}
</style>
{% endblock %}

{% block actions %}
<div id="actions">
  <h2>Actions</h2>
  <ul class="fa-ul">
    <li>
      <a href="{% url 'faculty.views.teaching_capacity_csv' %}?{{ request.GET.urlencode }}">
        <i class="fa fa-li fa-download"></i> Download CSV
      </a>
    </li>
  </ul>
</div>
{% endblock %}

{% block subbreadcrumbs %}
<li><a href="{% url "faculty.views.index" %}">Faculty</a></li>
<li>Teaching Capacity by Unit</li>
{% endblock %}

{% block content %}
<form action="" method="GET" class="noprint">
  {{ form.as_p }}
  <input type="submit" value="Select" />
</form>

{% for unit_name, info in units %}
{% with unit_capacity=info.0 summaries=info.1 %}
<div class="capacity-unit">
  <h3>
    <i class="fa {{ summaries|yesno:'fa-toggle-down,fa-times' }}"></i>
    {{ unit_name }}
    <small>Available Capacity: {{ unit_capacity|fraction_display }}</small>
  </h3>
  {% if summaries %}
  <div class="capacity-unit-inner hidden">
  <table>
    <thead><tr>
      <th class="name" scope="col">Name</th>
      <th scope="col">Teaching Credits</th>
      <th scope="col">Load Decrease</th>
      <th scope="col">Available Capacity</th>
    </tr></thead>
    <tbody>
    {% for person, credits, load_decrease, capacity in summaries %}
      <tr>
        <td>
          <a href="{% url 'faculty.views.teaching_summary' person.userid_or_emplid %}?start_semester={{ semester.name }}&end_semester={{ semester.name }}">
            {{ person }}
          </a>
        </td>
        <td>{{ credits|fraction_display }}</td>
        <td>{{ load_decrease|fraction_display }}</td>
        <td>{{ capacity|fraction_display }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  </div>
  {% endif %}
</div>
{% endwith %}
{% endfor %}
{% endblock %}
